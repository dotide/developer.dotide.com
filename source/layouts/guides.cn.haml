= wrap_layout 'cn' do
  .row.main-content
    .large-3.small-12.columns
      .hide-for-small
        .sidebar
          %nav
            %ul.side-nav
              %li.heading
                %i.fa.fa-book
                = '指南'
              %li.nav-guides-howto
                = link_to '概述', '/guides/howto.html'
              %li.nav-guides-quickstart
                = link_to '快速入门', '/guides/quickstart.html'
              %li.nav-guides-data-model
                = link_to '如何进行数据建模', '/guides/data-model.html'
              %li.nav-guides-programming-model
                = link_to '编程模型', '/guides/programming-model.html'
    .large-9.small-12.columns
      .right-content
        - if content_for? :raw_content
          = yield_content :raw_content
        - else
          %h1= current_page.data.title
          - if current_page.data.outlines
            %ul.toc
              - current_page.data.outlines.each_with_index do |o, i|
                %li
                  %a{href: "##{i+1}-#{o.gsub(/\s+/, '-')}"}= o
          .markdown= yield

  - content_for :second_nav do
    %ul.off-canvas-list
      %li
        %label= '指南'
      %li.nav-guides-overview
        = link_to '概述', '/guides/howto.html'
      %li.nav-guides-data-model
        = link_to '如何进行数据建模', '/guides/data-model.html'
      %li.nav-guides-programming-model
        = link_to '编程模型', '/guides/programming-model.html'

  - content_for :javascripts do
    :coffee
      $('li.nav-guides').addClass('active')
      $("li.nav-#{current_page.data.category}-#{current_page.data.section}").addClass('active')
      h2_idx = 0
      h3_idx = 0
      toc = $('ol.toc')
      lnode = toc
      $('.markdown h2, .markdown h3').each ()->
        elem = $(this);
        hc = elem.text().replace(/\s+/g, '-')
        if elem.prop('tagName') is 'H2'
          id = (h2_idx + 1).toString() + '-' + hc
          anchor = '<a href=#' + id + '><i class="fa fa-chain"></i></a>'
          elem.prepend(anchor);
          elem.attr('id', id)
          toc_item = '<li><a href="' + id + '">' + hc + '</a><ol></ol></li>'
          toc.append(toc_item)
          lnode = toc.children().last().children('ol')
          h2_idx += 1
        else
          id = (h2_idx + 1).toString() + '-' + (h3_idx + 1).toString() + '-' + hc
          anchor = '<a href=#' + id + '><i class="fa fa-chain"></i></a>'
          elem.prepend(anchor);
          elem.attr('id', id)
          toc_item = '<li><a href="' + id + '">' + hc + '</a></li>'
          lnode.append(toc_item)
          h3_idx += 1
